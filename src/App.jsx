// App.jsx (ƒê√£ c·∫≠p nh·∫≠t)

import React, { useState, useEffect } from "react";
import "./App.css";
import {
  FiBell,
  FiInbox,
  FiMail,
  FiTrash2,
  FiFilter,
  FiSettings,
  FiSearch,
  FiRefreshCw,
  FiAlertCircle,
  FiCheckCircle,
  FiMenu,
  FiLogOut,
  FiUsers, // Icon cho Admin: User Management
  FiShield, // Icon cho Admin Panel
  FiActivity, // Icon cho Dashboard Admin
  FiFileText, // Icon cho Logs Admin
  FiAlertOctagon, // Icon c·∫£nh b√°o
  FiDownload, // Icon t·∫£i xu·ªëng
  FiPlus, // Icon th√™m m·ªõi
  FiKey, // Icon b·∫£o m·∫≠t
} from "react-icons/fi";

// D·ªØ li·ªáu ng∆∞·ªùi d√πng gi·∫£ (ƒê√É C·∫¨P NH·∫¨T)
let fakeUser = { 
  name: "Regular User", 
  email: "user@gmail.com", 
  password: "123456",
  role: "user" 
};

let fakeAdmin = {
    name: "System Admin",
    email: "admin@gmail.com",
    password: "adminpassword", // M·∫≠t kh·∫©u Admin ri√™ng
    role: "admin"
}

function App() {
  // State ƒëi·ªÅu h∆∞·ªõng
  const [page, setPage] = useState("login"); // login | register | forgot | dashboard | admin
  const [activeView, setActiveView] = useState("inbox"); // inbox | all | junk | filters | settings | dashboard | users | logs | admin_settings

  // State x√°c th·ª±c
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [confirm, setConfirm] = useState("");
  const [remember, setRemember] = useState(false);
  const [message, setMessage] = useState("");
  const [userRole, setUserRole] = useState(null); // Vai tr√≤ ng∆∞·ªùi d√πng (null, 'user', 'admin')

  // State Dashboard User
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  
  // State cho trang Settings
  const [profileName, setProfileName] = useState(fakeUser.name);
  const [profileEmail, setProfileEmail] = useState(fakeUser.email);
  const [oldPassword, setOldPassword] = useState("");
  const [newPassword, setNewPassword] = useState("");
  const [confirmNew, setConfirmNew] = useState("");
  const [settingsMessage, setSettingsMessage] = useState("");

  // State Admin
  const [adminCurrentTab, setAdminCurrentTab] = useState('dashboard'); // tab hi·ªán t·∫°i trong Admin Panel
  
  // --- H√ÄM X√ÅC TH·ª∞C & ƒêI·ªÄU H∆Ø·ªöNG ---

  const clearAuthForms = () => {
    setEmail("");
    setPassword("");
    setConfirm("");
    setMessage("");
  };

  const clearSettingsForms = () => {
    setOldPassword("");
    setNewPassword("");
    setConfirmNew("");
    setSettingsMessage("");
  };

  // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p (ƒê√É C·∫¨P NH·∫¨T)
  const handleLogin = (e) => {
    e.preventDefault();
    let authenticatedUser = null;

    if (email === fakeUser.email && password === fakeUser.password) {
        authenticatedUser = fakeUser;
    } else if (email === fakeAdmin.email && password === fakeAdmin.password) {
        authenticatedUser = fakeAdmin;
    }

    if (authenticatedUser) {
        setMessage(`‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Vai tr√≤: ${authenticatedUser.role.toUpperCase()}`);
        setUserRole(authenticatedUser.role);
        setProfileName(authenticatedUser.name); // Thi·∫øt l·∫≠p t√™n profile
        setProfileEmail(authenticatedUser.email); // Thi·∫øt l·∫≠p email profile

        setTimeout(() => {
            if (authenticatedUser.role === 'admin') {
                setPage("admin");
                setAdminCurrentTab('dashboard');
            } else {
                setPage("dashboard");
                setActiveView("inbox");
            }
            setMessage("");
        }, 800);
    } else {
        setMessage("‚ùå Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c.");
    }
  };

  // X·ª≠ l√Ω ƒëƒÉng k√Ω (Gi·ªØ nguy√™n)
  const handleRegister = (e) => {
    e.preventDefault();
    if (!email || !password || !confirm) {
      setMessage("‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn t·∫•t c·∫£ c√°c tr∆∞·ªùng."); return;
    }
    if (!/\S+@\S+\.\S+/.test(email)) {
      setMessage("‚ö†Ô∏è ƒê·ªãnh d·∫°ng email kh√¥ng h·ª£p l·ªá."); return;
    }
    if (password.length < 6) {
      setMessage("‚ö†Ô∏è M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±."); return;
    }
    if (password !== confirm) {
      setMessage("‚ö†Ô∏è M·∫≠t kh·∫©u kh√¥ng kh·ªõp."); return;
    }
    setMessage("üéâ ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.");
    setTimeout(() => {
      setPage("login");
      clearAuthForms();
    }, 1500);
  };

  // X·ª≠ l√Ω qu√™n m·∫≠t kh·∫©u (Gi·ªØ nguy√™n)
  const handleForgot = (e) => {
    e.preventDefault();
    if (!email) {
      setMessage("Vui l√≤ng nh·∫≠p email c·ªßa b·∫°n."); return;
    }
    setMessage(`üìß Li√™n k·∫øt ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ${email}`);
    setTimeout(() => {
      setPage("login");
      clearAuthForms();
    }, 1500);
  };

  // X·ª¨ L√ù ƒêƒÇNG XU·∫§T (C·∫¨P NH·∫¨T)
  const handleLogout = () => {
    // Reset t·∫•t c·∫£ state v·ªÅ m·∫∑c ƒë·ªãnh
    clearAuthForms();
    clearSettingsForms();
    setNotifications([]);
    setLoading(true);
    setProfileName(fakeUser.name); 
    setProfileEmail(fakeUser.email);
    setUserRole(null); // Reset role
    
    // Chuy·ªÉn v·ªÅ trang ƒëƒÉng nh·∫≠p
    setPage("login");
  };

  // --- T·∫¢I D·ªÆ LI·ªÜU ---

  // T·∫£i d·ªØ li·ªáu th√¥ng b√°o (gi·∫£) khi v√†o dashboard
  useEffect(() => {
    // Ch·ªâ t·∫£i khi ·ªü dashboard (User) v√† xem inbox
    if (page !== "dashboard" || activeView !== "inbox") {
      setLoading(true);
      return;
    }
    // Logic t·∫£i d·ªØ li·ªáu... (Gi·ªØ nguy√™n)
    setLoading(true);
    setTimeout(() => {
      setNotifications([
        { id: 1, title: "Meeting Reminder", source: "calendar@google.com", content: "Your team meeting starts in 30 minutes. Join via Google Meet.", time: "10:30 AM", priority: true, read: false },
        { id: 2, title: "New Message from John", source: "john.doe@example.com", content: "Hey, just checking in about the project proposal.", time: "9:45 AM", priority: false, read: true },
        { id: 3, title: "New Facebook Message", source: "Sarah Johnson", content: "Are we still on for dinner this Friday?", time: "Yesterday", priority: false, read: true },
      ]);
      setLoading(false);
    }, 1000);
  }, [page, activeView]);

  // Chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i ∆∞u ti√™n
  const togglePriority = (id) => {
    setNotifications((prev) =>
      prev.map((n) => (n.id === id ? { ...n, priority: !n.priority } : n))
    );
  };


  // --- COMPONENT CON CHO C√ÅC VIEW (USER) ---
  
  // Component cho trang Account Settings (Gi·ªØ nguy√™n)
  const AccountSettingsPage = () => {
    // ... (Gi·ªØ nguy√™n logic Profile v√† Password update) ...
    const handleUpdateProfile = (e) => {
      e.preventDefault();
      // Logic c·∫≠p nh·∫≠t fakeUser/fakeAdmin (ph·ª©c t·∫°p h∆°n)
      if(userRole === 'admin') {
          fakeAdmin.name = profileName;
          fakeAdmin.email = profileEmail;
      } else {
          fakeUser.name = profileName;
          fakeUser.email = profileEmail;
      }
      setSettingsMessage("‚úÖ C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
      setTimeout(() => setSettingsMessage(""), 2000);
    };

    const handleChangePassword = (e) => {
      e.preventDefault();
      setSettingsMessage("");
      let targetUser = userRole === 'admin' ? fakeAdmin : fakeUser;

      if (!oldPassword || !newPassword || !confirmNew) {
        setSettingsMessage("‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn t·∫•t c·∫£ c√°c tr∆∞·ªùng."); return;
      }
      if (oldPassword !== targetUser.password) {
        setSettingsMessage("‚ùå M·∫≠t kh·∫©u c≈© kh√¥ng ch√≠nh x√°c."); return;
      }
      if (newPassword.length < 6) {
        setSettingsMessage("‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±."); return;
      }
      if (newPassword !== confirmNew) {
        setSettingsMessage("‚ö†Ô∏è M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp."); return;
      }

      // Th√†nh c√¥ng
      targetUser.password = newPassword; // C·∫≠p nh·∫≠t m·∫≠t kh·∫©u (gi·∫£)
      setSettingsMessage("‚úÖ C·∫≠p nh·∫≠t m·∫≠t kh·∫©u th√†nh c√¥ng!");
      clearSettingsForms();
    };

    return (
      <section className="dashboard settings-page">
        <div className="dashboard-header">
          <h1>Account Settings</h1>
        </div>

        <div className="settings-container">
          {/* Card 1: Profile */}
          <div className="setting-card">
            <h2>Th√¥ng tin c√° nh√¢n</h2>
            <form onSubmit={handleUpdateProfile} className="login-form">
              <label>T√™n hi·ªÉn th·ªã</label>
              <input type="text" value={profileName} onChange={(e) => setProfileName(e.target.value)} />
              <label>Email</label>
              <input type="email" value={profileEmail} onChange={(e) => setProfileEmail(e.target.value)} />
              <button type="submit" className="signin-btn">C·∫≠p nh·∫≠t th√¥ng tin</button>
            </form>
          </div>

          {/* Card 2: Password */}
          <div className="setting-card">
            <h2>ƒê·ªïi m·∫≠t kh·∫©u</h2>
            <form onSubmit={handleChangePassword} className="login-form">
              <label>M·∫≠t kh·∫©u c≈©</label>
              <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={oldPassword} onChange={(e) => setOldPassword(e.target.value)} />
              <label>M·∫≠t kh·∫©u m·ªõi</label>
              <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={newPassword} onChange={(e) => setNewPassword(e.target.value)} />
              <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
              <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={confirmNew} onChange={(e) => setConfirmNew(e.target.value)} />
              <button type="submit" className="signin-btn">ƒê·ªïi m·∫≠t kh·∫©u</button>
              {settingsMessage && <p className="message">{settingsMessage}</p>}
            </form>
          </div>
        </div>
      </section>
    );
  };

  // Component cho trang Inbox (ch√≠nh) (Gi·ªØ nguy√™n)
  const InboxPage = () => (
    <section className="dashboard">
      <div className="dashboard-header">
        <h1>Priority Inbox</h1>
        <button className="refresh-btn">
          <FiRefreshCw className="refresh-icon" />
          Refresh
        </button>
      </div>
      {/* Th·∫ª th·ªëng k√™ (Gi·ªØ nguy√™n) */}
      <div className="stats-container">
        <div className="stat-card"><div className="stat-info"><p className="stat-title">Total Notifications</p><p className="stat-value">124</p></div><div className="stat-icon"> <FiBell /> </div></div>
        <div className="stat-card"><div className="stat-info"><p className="stat-title">Priority Items</p><p className="stat-value">28</p></div><div className="stat-icon warning"> <FiAlertCircle /> </div></div>
        <div className="stat-card"><div className="stat-info"><p className="stat-title">Accuracy Rate</p><p className="stat-value">92%</p></div><div className="stat-icon success"> <FiCheckCircle /> </div></div>
      </div>
      {/* Danh s√°ch th√¥ng b√°o (Gi·ªØ nguy√™n) */}
      <div className="notifications-list">
        {loading ? (<div className="loading">Loading notifications...</div>) : (
          notifications.map((n) => (
            <div key={n.id} className={`notification-card ${n.priority ? "priority" : ""}`} >
              <div className="notification-content">
                <div className="notification-icon">{n.priority ? (<FiAlertCircle className="priority-icon" />) : (<FiMail />)}</div>
                <div className="notification-details">
                  <h3>{n.title}</h3>
                  <p className="notification-source">From: {n.source}</p>
                  <p className="notification-message">{n.content}</p>
                </div>
              </div>
              <div className="notification-actions">
                <span className="notification-time">{n.time}</span>
                <div className="action-buttons">
                  <button className={`priority-btn ${n.priority ? "active" : ""}`} onClick={() => togglePriority(n.id)}>{n.priority ? "Important" : "Not Important"}</button>
                </div>
              </div>
            </div>
          ))
        )}
      </div>
    </section>
  );

  // Component gi·ªØ ch·ªó cho c√°c trang kh√°c (Gi·ªØ nguy√™n)
  const PlaceholderPage = ({ title }) => (
    <section className="dashboard">
      <div className="dashboard-header">
        <h1>{title}</h1>
      </div>
      <div className="placeholder-content">
        <h2>Ch·ª©c nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn üöß</h2>
        <p>N·ªôi dung cho trang '{title}' s·∫Ω s·ªõm c√≥ m·∫∑t.</p>
      </div>
    </section>
  );

  // --- COMPONENT ADMIN (M·ªöI) ---
  
  // D·ªØ li·ªáu menu Admin
  const adminNav = [
    { id: 'dashboard', name: 'Admin Dashboard', icon: FiActivity, color: '#3b82f6' },
    { id: 'users', name: 'User Management', icon: FiUsers, color: '#06d6a0' },
    { id: 'logs', name: 'System Logs', icon: FiFileText, color: '#ffbe0b' },
    { id: 'admin_settings', name: 'Admin Settings', icon: FiSettings, color: '#ef476f' },
  ];

  // Component N·ªôi dung Tab Admin
  const AdminContent = ({ currentTab }) => {
    const handleAdminAction = (action) => alert(`Action: ${action} - Executed (Simulated)`);

    const DashboardContent = () => (
      <div id="admin-dashboard">
          <h1 className="admin-title">System Overview</h1>
          <div className="stats-container admin-stats">
              <div className="stat-card admin-stat-card">
                  <div className="stat-info">
                      <p className="stat-title">Total Users</p>
                      <p className="stat-value">1,248</p>
                  </div>
                  <div className="stat-icon" style={{ background: 'rgba(59, 130, 246, 0.1)', color: '#3b82f6' }}><FiUsers /></div>
              </div>
              <div className="stat-card admin-stat-card">
                  <div className="stat-info">
                      <p className="stat-title">Critical Errors</p>
                      <p className="stat-value">12</p>
                  </div>
                  <div className="stat-icon" style={{ background: 'rgba(239, 71, 111, 0.1)', color: '#ef476f' }}><FiAlertOctagon /></div>
              </div>
              <div className="stat-card admin-stat-card">
                  <div className="stat-info">
                      <p className="stat-title">System Uptime</p>
                      <p className="stat-value">99.98%</p>
                  </div>
                  <div className="stat-icon" style={{ background: 'rgba(6, 214, 160, 0.1)', color: '#06d6a0' }}><FiCheckCircle /></div>
              </div>
          </div>

          <div className="setting-card">
              <h2>Global Notification Broadcast</h2>
              <form onSubmit={(e) => { e.preventDefault(); handleAdminAction('Send Global Message'); }} className="login-form">
                  <label>Message Content</label>
                  <textarea rows="3" placeholder="Enter message to all users..." className="admin-textarea" required></textarea>
                  <button type="submit" className="signin-btn" style={{ background: '#ef476f' }}>Send Critical Alert</button>
              </form>
          </div>
      </div>
    );

    const UserManagementContent = () => (
      <div id="user-management">
        <h1 className="admin-title">User Management</h1>
        <div className="admin-actions">
          <button className="refresh-btn" onClick={() => handleAdminAction('Add User')}><FiPlus className="refresh-icon" />Add New User</button>
          <button className="refresh-btn" onClick={() => handleAdminAction('Export Data')}><FiDownload className="refresh-icon" />Export Data</button>
        </div>
        
        <div className="notifications-list"> {/* T√°i s·ª≠ d·ª•ng style list */}
            <div className="notification-card">
                <div className="notification-content">
                    <div className="notification-icon" style={{background: 'rgba(59, 130, 246, 0.1)', color: '#3b82f6'}}>
                        <FiUsers />
                    </div>
                    <div className="notification-details">
                        <h3>John Doe (Admin)</h3>
                        <p className="notification-source">john.doe@notifruit.com | Role: **Admin**</p>
                        <p className="notification-message">Last login: 2 minutes ago | Status: Active</p>
                    </div>
                </div>
                <div className="notification-actions">
                    <button className="priority-btn active" onClick={() => handleAdminAction('Edit John')}>Edit</button>
                    <button className="priority-btn" style={{background: '#ef476f', color: 'white'}} onClick={() => handleAdminAction('Suspend John')}>Suspend</button>
                </div>
            </div>
             <div className="notification-card">
                <div className="notification-content">
                    <div className="notification-icon" style={{background: 'rgba(6, 214, 160, 0.1)', color: '#06d6a0'}}>
                        <FiUsers />
                    </div>
                    <div className="notification-details">
                        <h3>{fakeUser.name} (User)</h3>
                        <p className="notification-source">{fakeUser.email} | Role: User</p>
                        <p className="notification-message">Last login: 5 hours ago | Status: Active</p>
                    </div>
                </div>
                <div className="notification-actions">
                    <button className="priority-btn active" onClick={() => handleAdminAction('Edit User')}>Edit</button>
                    <button className="priority-btn" style={{background: '#ffbe0b', color: 'white'}} onClick={() => handleAdminAction('Force Logout User')}>Force Logout</button>
                </div>
            </div>
        </div>
      </div>
    );

    const SystemLogsContent = () => (
      <div id="system-logs">
        <h1 className="admin-title">System Logs (Simulated)</h1>
        <div className="notifications-list">
             <div className="notification-card priority" style={{borderLeftColor: '#ef476f'}}>
                <div className="notification-content">
                    <div className="notification-icon" style={{background: 'rgba(239, 71, 111, 0.1)', color: '#ef476f'}}>
                        <FiAlertOctagon />
                    </div>
                    <div className="notification-details">
                        <h3>CRITICAL: Database Failure</h3>
                        <p className="notification-source">Source: DB-Server-01</p>
                        <p className="notification-message">Connection pool exhausted. Attempted 5 auto-reconnects. Status: Offline.</p>
                    </div>
                </div>
                <div className="notification-actions"><span className="notification-time">2 mins ago</span></div>
            </div>
            <div className="notification-card">
                <div className="notification-content">
                    <div className="notification-icon" style={{background: 'rgba(6, 214, 160, 0.1)', color: '#06d6a0'}}>
                        <FiCheckCircle />
                    </div>
                    <div className="notification-details">
                        <h3>SUCCESS: User Login</h3>
                        <p className="notification-source">User: {fakeAdmin.email}</p>
                        <p className="notification-message">IP: 203.0.113.45 | Session created successfully.</p>
                    </div>
                </div>
                 <div className="notification-actions"><span className="notification-time">5 mins ago</span></div>
            </div>
        </div>
      </div>
    );

    const AdminSettingsContent = () => (
        <div id="admin-settings">
            <h1 className="admin-title">Global System Settings</h1>
            <div className="settings-container">
                <div className="setting-card">
                    <h2>Maintenance Mode</h2>
                    <p className="text-light-sm">Toggle ƒë·ªÉ k√≠ch ho·∫°t ho·∫∑c h·ªßy k√≠ch ho·∫°t ch·∫ø ƒë·ªô b·∫£o tr√¨ to√†n h·ªá th·ªëng.</p>
                    <div className="form-row" style={{marginTop: '1.5rem', borderTop: '1px solid #e5e7eb', paddingTop: '1rem'}}>
                        <label className="remember">
                            <input type="checkbox" onChange={() => handleAdminAction('Toggle Maintenance')} />
                            Activate Maintenance Mode
                        </label>
                        <button className="signin-btn" style={{ background: '#ffbe0b', padding: '0.5rem 1rem', marginTop: 0 }} onClick={() => handleAdminAction('Schedule Downtime')}>Schedule</button>
                    </div>
                </div>
                <div className="setting-card">
                    <h2>API Keys & Security</h2>
                    <p className="text-light-sm">Qu·∫£n l√Ω Master API Key v√† c√†i ƒë·∫∑t b·∫£o m·∫≠t. **H√†nh ƒë·ªông kh√¥ng th·ªÉ ho√†n t√°c.**</p>
                    <div className="login-form" style={{marginTop: '1rem'}}>
                        <button className="signin-btn" style={{ background: '#ef476f', marginTop: 0 }} onClick={() => handleAdminAction('Regenerate Master Key')}>
                            <FiKey className="nav-icon" style={{marginRight: '0.5rem'}}/> Regenerate Master API Key
                        </button>
                        <button className="signin-btn" style={{ background: '#9ca3af', marginTop: '0.5rem' }} onClick={() => handleAdminAction('Flush Cache')}>
                             <FiRefreshCw className="nav-icon" style={{marginRight: '0.5rem'}}/> Flush Global Cache
                        </button>
                    </div>
                </div>
            </div>
        </div>
    );

    switch (currentTab) {
      case 'dashboard': return <DashboardContent />;
      case 'users': return <UserManagementContent />;
      case 'logs': return <SystemLogsContent />;
      case 'admin_settings': return <AdminSettingsContent />;
      default: return <DashboardContent />;
    }
  };

  // Component Khung Admin Dashboard
  const AdminDashboard = () => (
      <div className="app-container">
          {/* --- SIDEBAR ADMIN --- */}
          <aside className={`sidebar ${sidebarOpen ? "active" : ""}`}>
              <div>
                  <div className="logo-container">
                      <FiShield className="logo-icon" style={{color: adminNav.find(n => n.id === adminCurrentTab)?.color || '#3b82f6'}} />
                      <span className="logo-text">ADMIN PANEL</span>
                  </div>

                  <nav className="nav-menu">
                      {adminNav.map(item => (
                          <button
                              key={item.id}
                              className={`nav-item ${adminCurrentTab === item.id ? 'active' : ''}`}
                              onClick={() => setAdminCurrentTab(item.id)}
                              style={adminCurrentTab === item.id ? { backgroundColor: `${item.color}1A`, color: item.color } : {}}
                          >
                              <item.icon className="nav-icon" style={adminCurrentTab === item.id ? { color: item.color } : {}}/>
                              {item.name}
                          </button>
                      ))}
                  </nav>
              </div>

              {/* N√öT ƒêƒÇNG XU·∫§T */}
              <div className="sidebar-footer">
                  <button onClick={handleLogout} className="nav-item logout-btn">
                      <FiLogOut className="nav-icon" />
                      ƒêƒÉng xu·∫•t
                  </button>
              </div>
          </aside>

          {/* --- MAIN CONTENT ADMIN --- */}
          <main className="main-content">
              <header className="app-header">
                  <div className="header-left">
                      <button className="mobile-menu-btn" onClick={() => setSidebarOpen(!sidebarOpen)}>
                          <FiMenu />
                      </button>
                  </div>

                  <div className="header-right">
                      <p className="text-light-sm" style={{marginRight: '1rem'}}>Logged in as: **{fakeAdmin.name}**</p>
                      <button className="header-btn notification-btn">
                          <FiBell />
                          <span className="badge">12</span>
                      </button>
                      <div className="user-avatar"><img src="https://i.pravatar.cc/40?img=6" alt="Admin Avatar" /></div>
                  </div>
              </header>

              <div className="dashboard admin-panel">
                  <AdminContent currentTab={adminCurrentTab} />
              </div>
          </main>
      </div>
  );
  

  // --- RENDER CH√çNH ---

  // ==== C√ÅC TRANG X√ÅC TH·ª∞C (Login, Register, Forgot) ====
  if (page === "login" || page === "register" || page === "forgot") {
    // ... (Gi·ªØ nguy√™n ph·∫ßn render Login/Register/Forgot) ...
     return (
      <div className="login-page">
        <div className="login-glass">
          <div className="text-center">
            <div className="logo-container">
              <i className="feather-icon">üîî</i>
              <span className="logo-text">SYNAPSE</span>
            </div>
            <p className="subtitle">Your smart notification hub</p>
          </div>

          {/* Ch·ªâ hi·ªÉn th·ªã n√∫t OAuth v√† Divider ·ªü trang Login */}
          {page === "login" && (
            <>
              <div className="button-group">
                <button className="oauth-btn">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg" alt="Google" />
                  Continue with Google
                </button>
                <button className="oauth-btn">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg" alt="Microsoft" />
                  Continue with Microsoft
                </button>
                <button className="oauth-btn">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub" />
                  Continue with GitHub
                </button>
              </div>
              <div className="divider"> <span>Or sign in with email</span> </div>
            </>
          )}

          {/* FORM LOGIN */}
          {page === "login" && (
            <form onSubmit={handleLogin} className="login-form">
              <label>Email address</label>
              <input type="email" placeholder="you@example.com" value={email} onChange={(e) => setEmail(e.target.value)} required />
              <label>Password</label>
              <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={password} onChange={(e) => setPassword(e.target.value)} required />

              <div className="form-row">
                <label className="remember">
                  <input type="checkbox" checked={remember} onChange={(e) => setRemember(e.target.checked)} />
                  Remember me
                </label>
                <button type="button" className="link" onClick={() => { setPage("forgot"); setMessage(""); }}>
                  Forgot password?
                </button>
              </div>

              <button type="submit" className="signin-btn"> Sign in </button>
              {message && <p className="message">{message}</p>}

              <p className="signup-text">
                Don't have an account?{" "}
                <button type="button" className="link" onClick={() => { setPage("register"); setMessage(""); }}>
                  Sign up
                </button>
              </p>
            </form>
          )}

          {/* FORM REGISTER */}
          {page === "register" && (
            <form onSubmit={handleRegister} className="login-form">
              <label>Email</label>
              <input type="email" placeholder="you@example.com" value={email} onChange={(e) => setEmail(e.target.value)} />
              <label>Password</label>
              <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={password} onChange={(e) => setPassword(e.target.value)} />
              <label>Confirm Password</label>
              <input type="password" placeholder="Re-enter password" value={confirm} onChange={(e) => setConfirm(e.target.value)} />
              <button type="submit" className="signin-btn"> Register </button>
              {message && <p className="message">{message}</p>}

              <p className="signup-text">
                Already have an account?{" "}
                <button type="button" className="link" onClick={() => { setPage("login"); setMessage(""); }}>
                  Login
                </button>
              </p>
            </form>
          )}

          {/* FORM FORGOT PASSWORD */}
          {page === "forgot" && (
            <form onSubmit={handleForgot} className="login-form">
              <label>Email</label>
              <input type="email" placeholder="Enter your email" value={email} onChange={(e) => setEmail(e.target.value)} />
              <button type="submit" className="signin-btn"> Send reset link </button>
              {message && <p className="message">{message}</p>}

              <p className="signup-text">
                Back to{" "}
                <button type="button" className="link" onClick={() => { setPage("login"); setMessage(""); }}>
                  login
                </button>
              </p>
            </form>
          )}
        </div>
      </div>
    );
  }
  
  // ==== TRANG ADMIN (M·ªöI) ====
  if (page === 'admin') {
      return <AdminDashboard />;
  }

  // ==== TRANG DASHBOARD USER ====
  // Ph·∫£i ƒë·∫£m b·∫£o ch·ªâ hi·ªÉn th·ªã khi `page === 'dashboard'`
  return (
    <div className="app-container">
      {/* --- SIDEBAR --- */}
      <aside className={`sidebar ${sidebarOpen ? "active" : ""}`}>
        <div>
          <div className="logo-container">
            <FiBell className="logo-icon" />
            <span className="logo-text">SYNAPSE</span>
          </div>

          <nav className="nav-menu">
            <button
              className={`nav-item ${activeView === 'inbox' ? 'active' : ''}`}
              onClick={() => setActiveView('inbox')}
            >
              <FiInbox className="nav-icon" />
              Priority Inbox
            </button>
            <button
              className={`nav-item ${activeView === 'all' ? 'active' : ''}`}
              onClick={() => setActiveView('all')}
            >
              <FiMail className="nav-icon" />
              All Notifications
            </button>
            <button
              className={`nav-item ${activeView === 'junk' ? 'active' : ''}`}
              onClick={() => setActiveView('junk')}
            >
              <FiTrash2 className="nav-icon" />
              Junk & Spam
            </button>
            <button
              className={`nav-item ${activeView === 'filters' ? 'active' : ''}`}
              onClick={() => setActiveView('filters')}
            >
              <FiFilter className="nav-icon" />
              Filter Settings
            </button>
            <button
              className={`nav-item ${activeView === 'settings' ? 'active' : ''}`}
              onClick={() => setActiveView('settings')}
            >
              <FiSettings className="nav-icon" />
              Account Settings
            </button>
             {/* N√öT ADMIN PANEL (Ch·ªâ hi·ªÉn th·ªã n·∫øu user l√† admin) */}
             {userRole === 'admin' && (
                <button
                    className={`nav-item admin-panel-btn`}
                    onClick={() => setPage('admin')}
                >
                    <FiShield className="nav-icon" />
                    Admin Panel
                </button>
            )}
          </nav>
        </div>

        {/* N√öT ƒêƒÇNG XU·∫§T */}
        <div className="sidebar-footer">
          <button onClick={handleLogout} className="nav-item logout-btn">
            <FiLogOut className="nav-icon" />
            ƒêƒÉng xu·∫•t
          </button>
        </div>
      </aside>

      {/* --- MAIN CONTENT --- */}
      <main className="main-content">
        <header className="app-header">
          <div className="header-left">
            <button
              className="mobile-menu-btn"
              onClick={() => setSidebarOpen(!sidebarOpen)}
            >
              <FiMenu />
            </button>
          </div>

          <div className="header-right">
            <button className="header-btn"> <FiSearch /> </button>
            <button className="header-btn notification-btn">
              <FiBell />
              <span className="badge">
                {notifications.filter((n) => !n.read).length}
              </span>
            </button>
            <div className="user-avatar">
              <img src="https://i.pravatar.cc/40" alt="User Avatar" />
            </div>
          </div>
        </header>

        {/* RENDER N·ªòI DUNG CH√çNH C√ì ƒêI·ªÄU KI·ªÜN */}
        {activeView === 'inbox' && <InboxPage />}
        {activeView === 'settings' && <AccountSettingsPage />}
        {activeView === 'all' && <PlaceholderPage title="All Notifications" />}
        {activeView === 'junk' && <PlaceholderPage title="Junk & Spam" />}
        {activeView === 'filters' && <PlaceholderPage title="Filter Settings" />}
        
      </main>
    </div>
  );
}

export default App;